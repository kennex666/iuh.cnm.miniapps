<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Mini Grab</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
	<style>
		body {
			font-family: 'Inter', sans-serif;
		}
	</style>
</head>
<body class="bg-gradient-to-tr from-green-50 to-blue-50 min-h-screen flex items-center justify-center">

	<!-- Loading -->
	<div id="loading" class="text-center text-green-600 text-lg font-semibold animate-pulse">
		ğŸš¦ Äang khá»Ÿi Ä‘á»™ng á»©ng dá»¥ng...
	</div>

	<!-- Giao diá»‡n chÃ­nh -->
	<div id="main" class="hidden w-full max-w-md bg-white rounded-3xl shadow-xl p-6 space-y-6">
		<!-- ThÃ´ng tin ngÆ°á»i dÃ¹ng -->
		<div class="flex items-center space-x-4">
			<img id="avatar" src="" class="w-16 h-16 rounded-full border-4 border-green-200 shadow" />
			<div>
				<p class="text-xl font-bold text-gray-900" id="username">TÃªn</p>
				<p class="text-sm text-gray-500">SÄT: <span id="account">...</span></p>
			</div>
		</div>

		<!-- Vá»‹ trÃ­ -->
		<div class="flex items-center justify-between">
			<div>
				<p class="text-xs text-gray-500">Vá»‹ trÃ­ hiá»‡n táº¡i:</p>
				<p id="location" class="text-sm font-semibold text-gray-700">Äang xÃ¡c minh...</p>
			</div>
			<button onclick="requestLocationPermission()" class="text-xs text-green-600 underline">
				<i class="fas fa-map-marker-alt"></i> Cáº­p nháº­t vá»‹ trÃ­
			</button>
		</div>

		<!-- Dá»‹ch vá»¥ -->
		<div>
			<h3 class="text-base font-semibold text-gray-700 mb-2">Dá»‹ch vá»¥ cá»§a báº¡n</h3>
			<div class="grid grid-cols-3 gap-4 text-center text-sm text-gray-700">
				<button class="p-4 bg-gray-50 rounded-xl shadow hover:bg-green-50 transition" onclick="book('Gá»i xe')">
					<i class="fas fa-car text-lg mb-1 text-green-500"></i>
					<p>Gá»i xe</p>
				</button>
				<button class="p-4 bg-gray-50 rounded-xl shadow hover:bg-green-50 transition" onclick="book('Giao Ä‘á»“ Äƒn')">
					<i class="fas fa-hamburger text-lg mb-1 text-green-500"></i>
					<p>Äá»“ Äƒn</p>
				</button>
				<button class="p-4 bg-gray-50 rounded-xl shadow hover:bg-green-50 transition" onclick="book('Mua há»™')">
					<i class="fas fa-shopping-basket text-lg mb-1 text-green-500"></i>
					<p>Mua há»™</p>
				</button>
			</div>
		</div>

		<!-- Tráº¡ng thÃ¡i -->
		<div id="status" class="text-sm text-gray-600 text-center italic"></div>
	</div>

	<script>
		let hasLocationPermission = false;

		function requestLocationPermission() {
			window.ReactNativeWebView?.postMessage(JSON.stringify({
				type: "REQUIRE_PERMISSIONS",
				data: "location"
			}));
			document.getElementById("location").innerText = "Äang yÃªu cáº§u quyá»n truy cáº­p vá»‹ trÃ­...";
		}

		function book(service) {
			if (!hasLocationPermission) {
				alert("âš ï¸ KhÃ´ng thá»ƒ sá»­ dá»¥ng dá»‹ch vá»¥ khi chÆ°a cáº¥p quyá»n vá»‹ trÃ­!");
				return;
			}
			document.getElementById("status").innerText = `ğŸš— Äang xá»­ lÃ½ dá»‹ch vá»¥ "${service}"...`;
			setTimeout(() => {
				document.getElementById("status").innerText = `âœ… Dá»‹ch vá»¥ "${service}" Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t thÃ nh cÃ´ng!`;
			}, 2000);
		}

		function initUser(data) {
			const { name, phone, avatarURL } = data;
			document.getElementById("loading").classList.add("hidden");
			document.getElementById("main").classList.remove("hidden");

			document.getElementById("username").innerText = name;
			document.getElementById("account").innerText = phone;
			document.getElementById("avatar").src = avatarURL || `https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(name)}`;
		}

		window.onload = function () {
			window.ReactNativeWebView?.postMessage(JSON.stringify({ type: "READY" }));

			window.addEventListener("message", function (event) {
				try {
					const data = typeof event.data === "string" ? JSON.parse(event.data) : event.data;

					if (data?.type === "ACCEPT_PERMISSIONS" && data.data.permission === "location") {
						hasLocationPermission = true;
						document.getElementById("location").innerText = "ğŸ“ 123 ÄÆ°á»ng Demo, TP.HCM";
						document.getElementById("status").innerText = "âœ… ÄÃ£ xÃ¡c Ä‘á»‹nh vá»‹ trÃ­!";
					} else if (data?.type === "DENY_PERMISSIONS") {
						hasLocationPermission = false;
						document.getElementById("location").innerText = "âŒ Quyá»n vá»‹ trÃ­ bá»‹ tá»« chá»‘i";
						document.getElementById("status").innerText = "Báº¡n cáº§n cáº¥p quyá»n Ä‘á»ƒ sá»­ dá»¥ng dá»‹ch vá»¥.";
					} else {
						initUser(data);
					}
				} catch (e) {
					console.warn("Lá»—i khi parse message:", event.data);
				}
			});
		};
	</script>
</body>
</html>
